import{o as H,p as ae,b as $e,c as Ne,u as U,l as De,k as ce,s as _e,m as de,x as je,q as Le,r as W,w as Ie,f as Re}from"./ResizeObserver.es.c9f0dcad.js";import{h as p,d as ke,ap as Fe,g as B,x as pe,an as He,j as Ve,o as d,b as N,w as O,aq as Ye,l as t,a5 as X,c as x,L as q,H as A,T as me,n as g,N as K,a6 as G,e as C,k as J,a1 as fe,I as Ue,r as Q,a as Z,t as ee,ae as D,ar as ve,af as ye,O as We}from"./framework.ae1e5339.js";import{s as we,e as Xe}from"./message.12adda7e.js";import{u as qe,a as Ke,b as ge,m as Ge,K as Je,o as Qe}from"./index.469502b6.js";import{T as be,f as Ce,c as Ze}from"./index.7cd2c9e5.js";import{u as eo}from"./index.4450953c.js";const oo=({modalRef:a,wrapperRef:r,draggable:i})=>{const m=p(!1),o=p([0,0]),f=p([0,0]),v=p([0,0]),s=p(),l=p([0,0]),h=()=>{var c,b;if(r.value&&a.value){const{top:T,left:u}=r.value.getBoundingClientRect(),{clientWidth:n,clientHeight:_}=r.value,{top:j,left:M,width:E,height:L}=a.value.getBoundingClientRect(),$=M-u,I=j-T;($!==((c=v.value)==null?void 0:c[0])||I!==((b=v.value)==null?void 0:b[1]))&&(v.value=[$,I]);const R=n>E?n-E:0,y=_>L?_-L:0;(R!==l.value[0]||y!==l.value[1])&&(l.value=[R,y])}},P=c=>{i.value&&(c.preventDefault(),m.value=!0,h(),o.value=[c.x,c.y],f.value=[0,0],H(window,"mousemove",z),H(window,"mouseup",k),H(window,"contextmenu",k))},z=c=>{if(m.value){const b=c.x-o.value[0],T=c.y-o.value[1];let u=v.value[0]+b,n=v.value[1]+T;u<0&&(u=0),u>l.value[0]&&(u=l.value[0]),n<0&&(n=0),n>l.value[1]&&(n=l.value[1]),s.value=[u,n]}},k=()=>{m.value=!1,ae(window,"mousemove",z),ae(window,"mouseup",k)};return{position:s,handleMoveDown:P}},ao=$e({visible:{type:Boolean,default:void 0},defaultVisible:{type:Boolean,default:!1},width:{type:[Number,String]},top:{type:[Number,String]},mask:{type:Boolean,default:!0},title:{type:String},titleAlign:{type:String,default:"start"},alignCenter:{type:Boolean,default:!0},unmountOnClose:Boolean,maskClosable:{type:Boolean,default:!0},hideCancel:{type:Boolean,default:!1},simple:{type:Boolean,default:a=>a.notice},closable:{type:Boolean,default:!0},okText:String,cancelText:String,okLoading:{type:Boolean,default:!1},okButtonProps:{type:Object},cancelButtonProps:{type:Object},footer:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},popupContainer:{type:[String,Object],default:"body"},maskStyle:{type:Object},modalClass:{type:[String,Array]},modalStyle:{type:Object},onBeforeOk:{type:Function},onBeforeCancel:{type:Function},escToClose:{type:Boolean,default:!0},size:{...Ne,default:"medium"},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},maskAnimationName:{type:String,default:a=>a.fullscreen?"fade-in-standard":"fade-modal"},modalAnimationName:{type:String,default:a=>a.fullscreen?"zoom-in":"zoom-modal"},bodyClass:{type:[String,Array]},bodyStyle:{type:[String,Object,Array]},messageType:{type:String,values:we,default:Xe.type}}),to={"update:visible":a=>!0,ok:a=>!0,cancel:a=>!0,open:()=>!0,close:()=>!0,beforeOpen:()=>!0,beforeClose:()=>!0};const lo=ke({name:"TuModal",inheritAttrs:!1}),Be=ke({...lo,props:ao,emits:to,setup(a,{emit:r}){let i=0,m=!1;const o=a,f=r,{t:v}=eo(),s=U("modal"),l=U("modal-container"),h=U("modal-wrapper"),{fullscreen:P,popupContainer:z}=Fe(o),k=p(),c=p(),b=p(o.defaultVisible),T=p(!1),u=p(!1),n=B(()=>o.visible??b.value),_=B(()=>o.okLoading||u.value),j=B(()=>be[o.messageType]||""),M=p(n.value),E=B(()=>o.draggable&&!o.fullscreen),{teleportContainer:L,containerRef:$}=qe({popupContainer:z,visible:n}),{zIndex:I,isLastDialog:R}=De("dialog",{visible:n}),{position:y,handleMoveDown:te}=oo({wrapperRef:k,modalRef:c,draggable:E}),{setOverflowHidden:le,resetOverflow:ne}=Ke($),he=B(()=>({[h.b()]:!0,[h.is("align-center")]:o.alignCenter&&!o.fullscreen,[h.is("moved")]:!!y.value})),Te=B(()=>{const e=o.messageType;return{[s.em("icon",e)]:e&&be[e]}}),Se=B(()=>[s.b(),o.modalClass,{[s.m(o.size)]:o.size,[s.m("simple")]:o.simple,[s.m("draggable")]:E.value,[s.m("fullscreen")]:o.fullscreen}]),Oe=B(()=>{const e={...o.modalStyle??{}};return o.width&&(e.width=ce(o.width)),!o.alignCenter&&o.top&&(e.top=ce(o.top)),y.value&&(e.transform=`translate(${y.value[0]}px, ${y.value[1]}px)`),e}),xe=e=>{o.mask&&o.maskClosable&&T.value&&F(e)},ze=e=>{e.target===k.value&&(T.value=!0)},Me=async e=>{const S=i,V=await new Promise(async Y=>{if(D(o.onBeforeOk)){let w=o.onBeforeOk((Pe=!0)=>Y(Pe));if((ve(w)||!de(w))&&(u.value=!0),ve(w))try{w=await w??!0}catch{w=!1}de(w)&&Y(w)}else Y(!0)});S===i&&(V?(f("ok",e),se()):u.value&&(u.value=!1))},F=e=>{let S=!0;D(o.onBeforeCancel)&&(S=o.onBeforeCancel()??!1),S&&(f("cancel",e),se())},se=()=>{i++,u.value&&(u.value=!1),b.value=!1,f("update:visible",!1)},Ee=()=>{n.value&&(!je(k.value,document.activeElement)&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),f("open"))},Ae=()=>{n.value||(E.value&&(y.value=void 0),M.value=!1,ne(),f("close"))},ie=()=>{o.escToClose&&!m&&(m=!0,H(document.documentElement,"keydown",re))},ue=()=>{m=!1,ae(document.documentElement,"keydown",re)},re=e=>{o.escToClose&&e.key===Je.ESC&&R()&&F(e)};return pe(P,()=>{y.value&&(y.value=void 0)}),pe(n,e=>{b.value!==e&&(b.value=e),e?(f("beforeOpen"),M.value=!0,T.value=!1,le(),ie()):(f("beforeClose"),ue())}),He(()=>{ne(),ue()}),Ve(()=>{$.value=_e(o.popupContainer),n.value&&(le(),o.escToClose&&ie())}),(e,S)=>(d(),N(t(Ge),null,{default:O(()=>[(d(),N(Ye,{to:t(L),disabled:!e.renderToBody},[!e.unmountOnClose||n.value||M.value?X((d(),x("div",q({key:0,class:t(l).b(),style:{zIndex:t(I)}},e.$attrs),[A(me,{name:e.maskAnimationName,appear:""},{default:O(()=>[e.mask?X((d(),x("div",{key:0,ref:"maskRef",class:g(t(l).e("mask")),style:K(e.maskStyle)},null,6)),[[G,n.value]]):C("",!0)]),_:1},8,["name"]),J("div",{ref_key:"wrapperRef",ref:k,class:g(he.value),onClick:fe(xe,["self"]),onMousedown:fe(ze,["self"])},[A(me,{appear:"",name:e.modalAnimationName,onAfterEnter:Ee,onAfterLeave:Ae},{default:O(()=>[X(J("div",{ref_key:"modalRef",ref:c,class:g(Se.value),style:K(Oe.value)},[e.$slots.title||e.title||e.closable?(d(),x("div",{key:0,class:g(t(s).e("header")),onMousedown:S[0]||(S[0]=(...V)=>t(te)&&t(te)(...V))},[e.$slots.title||e.title?(d(),x("div",{key:0,class:g([t(s).e("title"),t(s).is(`align-${e.titleAlign}`)])},[e.messageType?(d(),x("div",{key:0,class:g(t(s).e("title-icon"))},[j.value?(d(),N(t(Ce),{key:0,class:g([t(s).e("icon"),Te.value])},{default:O(()=>[(d(),N(Ue(j.value)))]),_:1},8,["class"])):C("",!0)],2)):C("",!0),Q(e.$slots,"title",{},()=>[Z(ee(e.title),1)])],2)):C("",!0),!e.simple&&e.closable?(d(),x("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:g(t(s).e("icon-close")),onClick:F},[A(t(Ce),null,{default:O(()=>[A(t(Ze))]),_:1})],2)):C("",!0)],34)):C("",!0),J("div",{class:g([t(s).e("body"),e.bodyClass]),style:K(e.bodyStyle)},[Q(e.$slots,"default")],6),e.footer?(d(),x("div",{key:1,class:g(t(s).e("footer"))},[Q(e.$slots,"footer",{},()=>[e.hideCancel?C("",!0):(d(),N(t(ge),q({key:0},e.cancelButtonProps,{size:e.size,onClick:F}),{default:O(()=>[Z(ee(e.cancelText||t(v)("tu.modal.cancel")),1)]),_:1},16,["size"])),A(t(ge),q({type:"primary"},e.okButtonProps,{size:e.size,loading:_.value,onClick:Me}),{default:O(()=>[Z(ee(e.okText||t(v)("tu.modal.confirm")),1)]),_:1},16,["size","loading"])])],2)):C("",!0)],6),[[G,n.value]])]),_:3},8,["name"])],34)],16)),[[G,n.value||M.value]]):C("",!0)],8,["to","disabled"]))]),_:3}))}}),oe=(a,r)=>{let i=Le("modal");const m=()=>{l.component&&(l.component.props.visible=!1),D(a.onOk)&&a.onOk()},o=()=>{l.component&&(l.component.props.visible=!1),D(a.onCancel)&&a.onCancel()},f=async()=>{await We(),i&&(ye(null,i),document.body.removeChild(i)),i=null,D(a.onClose)&&a.onClose()},v=()=>{l.component&&(l.component.props.visible=!1)},s=h=>{l.component&&Object.entries(h).forEach(([P,z])=>{l.component.props[P]=z})},l=A(Be,{visible:!0,renderToBody:!1,unmountOnClose:!0,onOk:m,onCancel:o,onClose:f,...Qe(a,["content","title","footer","visible","unmountOnClose","onOk","onCancel","onClose"]),footer:typeof a.footer=="boolean"?a.footer:void 0},{default:W(a.content),title:W(a.title),footer:typeof a.footer!="boolean"?W(a.footer):void 0});return r&&(l.appContext=r),ye(l,i),document.body.appendChild(i),{close:v,update:s}},no={open:oe,confirm:(a,r)=>{const i={simple:!0,...a};return oe(i,r)},...we.reduce((a,r)=>(a[r]=(i,m)=>{const o={simple:!0,hideCancel:!0,messageType:r,...i};return oe(o,m)},a),{})},mo=Ie(Be),fo=Re(no,"$modal");export{fo as d,mo as s};
