import{o as H,p as te,b as _e,c as $e,u as W,l as Ne,k as de,s as De,m as pe,x as je,q as Le,r as X,w as Ie,f as Re}from"./ResizeObserver.es.a10a1b77.js";import{h as p,d as we,ap as Fe,g as B,x as me,an as He,j as Ve,o as d,b as $,w as x,aq as Ye,l as t,a5 as q,c as O,L as K,H as A,T as fe,n as g,N as G,a6 as J,e as C,k as Q,a1 as ve,I as Ue,r as Z,a as ee,t as oe,ae as N,ar as ye,af as ge,O as We}from"./framework.ae1e5339.js";import{s as Be,e as Xe}from"./message.7454ae3f.js";import{u as qe,a as Ke,b as be,m as Ge,K as Je,o as Qe}from"./index.872f5dc5.js";import{T as Ce,f as ke,c as Ze}from"./index.441c77ca.js";import{u as eo}from"./index.4450953c.js";const oo=({modalRef:a,wrapperRef:r,draggable:i})=>{const m=p(!1),o=p([0,0]),f=p([0,0]),v=p([0,0]),s=p(),l=p([0,0]),h=()=>{var c,b;if(r.value&&a.value){const{top:T,left:u}=r.value.getBoundingClientRect(),{clientWidth:n,clientHeight:D}=r.value,{top:j,left:M,width:E,height:L}=a.value.getBoundingClientRect(),_=M-u,I=j-T;(_!==((c=v.value)==null?void 0:c[0])||I!==((b=v.value)==null?void 0:b[1]))&&(v.value=[_,I]);const R=n>E?n-E:0,y=D>L?D-L:0;(R!==l.value[0]||y!==l.value[1])&&(l.value=[R,y])}},P=c=>{i.value&&(c.preventDefault(),m.value=!0,h(),o.value=[c.x,c.y],f.value=[0,0],H(window,"mousemove",z),H(window,"mouseup",k),H(window,"contextmenu",k))},z=c=>{if(m.value){const b=c.x-o.value[0],T=c.y-o.value[1];let u=v.value[0]+b,n=v.value[1]+T;u<0&&(u=0),u>l.value[0]&&(u=l.value[0]),n<0&&(n=0),n>l.value[1]&&(n=l.value[1]),s.value=[u,n]}},k=()=>{m.value=!1,te(window,"mousemove",z),te(window,"mouseup",k)};return{position:s,handleMoveDown:P}},ao=_e({visible:{type:Boolean,default:void 0},defaultVisible:{type:Boolean,default:!1},width:{type:[Number,String]},top:{type:[Number,String]},mask:{type:Boolean,default:!0},title:{type:String},titleAlign:{type:String,default:"start"},alignCenter:{type:Boolean,default:!0},unmountOnClose:Boolean,maskClosable:{type:Boolean,default:!0},hideCancel:{type:Boolean,default:!1},simple:{type:Boolean,default:a=>a.notice},closable:{type:Boolean,default:!0},okText:String,cancelText:String,okLoading:{type:Boolean,default:!1},okButtonProps:{type:Object},cancelButtonProps:{type:Object},footer:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},popupContainer:{type:[String,Object],default:"body"},maskStyle:{type:Object},modalClass:{type:[String,Array]},modalStyle:{type:Object},onBeforeOk:{type:Function},onBeforeCancel:{type:Function},escToClose:{type:Boolean,default:!0},size:{...$e,default:"medium"},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},maskAnimationName:{type:String,default:a=>a.fullscreen?"fade-in-standard":"fade-modal"},modalAnimationName:{type:String,default:a=>a.fullscreen?"zoom-in":"zoom-modal"},bodyClass:{type:[String,Array]},bodyStyle:{type:[String,Object,Array]},messageType:{type:String,values:Be,default:Xe.type}}),to={"update:visible":a=>!0,ok:a=>!0,cancel:a=>!0,open:()=>!0,close:()=>!0,beforeOpen:()=>!0,beforeClose:()=>!0};const lo=we({name:"TuModal",inheritAttrs:!1}),V=we({...lo,props:ao,emits:to,setup(a,{emit:r}){let i=0,m=!1;const o=a,f=r,{t:v}=eo(),s=W("modal"),l=W("modal-container"),h=W("modal-wrapper"),{fullscreen:P,popupContainer:z}=Fe(o),k=p(),c=p(),b=p(o.defaultVisible),T=p(!1),u=p(!1),n=B(()=>o.visible??b.value),D=B(()=>o.okLoading||u.value),j=B(()=>Ce[o.messageType]||""),M=p(n.value),E=B(()=>o.draggable&&!o.fullscreen),{teleportContainer:L,containerRef:_}=qe({popupContainer:z,visible:n}),{zIndex:I,isLastDialog:R}=Ne("dialog",{visible:n}),{position:y,handleMoveDown:le}=oo({wrapperRef:k,modalRef:c,draggable:E}),{setOverflowHidden:ne,resetOverflow:se}=Ke(_),he=B(()=>({[h.b()]:!0,[h.is("align-center")]:o.alignCenter&&!o.fullscreen,[h.is("moved")]:!!y.value})),Te=B(()=>{const e=o.messageType;return{[s.em("icon",e)]:e&&Ce[e]}}),Se=B(()=>[s.b(),o.modalClass,{[s.m(o.size)]:o.size,[s.m("simple")]:o.simple,[s.m("draggable")]:E.value,[s.m("fullscreen")]:o.fullscreen}]),xe=B(()=>{const e={...o.modalStyle??{}};return o.width&&(e.width=de(o.width)),!o.alignCenter&&o.top&&(e.top=de(o.top)),y.value&&(e.transform=`translate(${y.value[0]}px, ${y.value[1]}px)`),e}),Oe=e=>{o.mask&&o.maskClosable&&T.value&&F(e)},ze=e=>{e.target===k.value&&(T.value=!0)},Me=async e=>{const S=i,Y=await new Promise(async U=>{if(N(o.onBeforeOk)){let w=o.onBeforeOk((Pe=!0)=>U(Pe));if((ye(w)||!pe(w))&&(u.value=!0),ye(w))try{w=await w??!0}catch{w=!1}pe(w)&&U(w)}else U(!0)});S===i&&(Y?(f("ok",e),ie()):u.value&&(u.value=!1))},F=e=>{let S=!0;N(o.onBeforeCancel)&&(S=o.onBeforeCancel()??!1),S&&(f("cancel",e),ie())},ie=()=>{i++,u.value&&(u.value=!1),b.value=!1,f("update:visible",!1)},Ee=()=>{n.value&&(!je(k.value,document.activeElement)&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),f("open"))},Ae=()=>{n.value||(E.value&&(y.value=void 0),M.value=!1,se(),f("close"))},ue=()=>{o.escToClose&&!m&&(m=!0,H(document.documentElement,"keydown",ce))},re=()=>{m=!1,te(document.documentElement,"keydown",ce)},ce=e=>{o.escToClose&&e.key===Je.ESC&&R()&&F(e)};return me(P,()=>{y.value&&(y.value=void 0)}),me(n,e=>{b.value!==e&&(b.value=e),e?(f("beforeOpen"),M.value=!0,T.value=!1,ne(),ue()):(f("beforeClose"),re())}),He(()=>{se(),re()}),Ve(()=>{_.value=De(o.popupContainer),n.value&&(ne(),o.escToClose&&ue())}),(e,S)=>(d(),$(t(Ge),null,{default:x(()=>[(d(),$(Ye,{to:t(L),disabled:!e.renderToBody},[!e.unmountOnClose||n.value||M.value?q((d(),O("div",K({key:0,class:t(l).b(),style:{zIndex:t(I)}},e.$attrs),[A(fe,{name:e.maskAnimationName,appear:""},{default:x(()=>[e.mask?q((d(),O("div",{key:0,ref:"maskRef",class:g(t(l).e("mask")),style:G(e.maskStyle)},null,6)),[[J,n.value]]):C("",!0)]),_:1},8,["name"]),Q("div",{ref_key:"wrapperRef",ref:k,class:g(he.value),onClick:ve(Oe,["self"]),onMousedown:ve(ze,["self"])},[A(fe,{appear:"",name:e.modalAnimationName,onAfterEnter:Ee,onAfterLeave:Ae},{default:x(()=>[q(Q("div",{ref_key:"modalRef",ref:c,class:g(Se.value),style:G(xe.value)},[e.$slots.title||e.title||e.closable?(d(),O("div",{key:0,class:g(t(s).e("header")),onMousedown:S[0]||(S[0]=(...Y)=>t(le)&&t(le)(...Y))},[e.$slots.title||e.title?(d(),O("div",{key:0,class:g([t(s).e("title"),t(s).is(`align-${e.titleAlign}`)])},[e.messageType?(d(),O("div",{key:0,class:g(t(s).e("title-icon"))},[j.value?(d(),$(t(ke),{key:0,class:g([t(s).e("icon"),Te.value])},{default:x(()=>[(d(),$(Ue(j.value)))]),_:1},8,["class"])):C("",!0)],2)):C("",!0),Z(e.$slots,"title",{},()=>[ee(oe(e.title),1)])],2)):C("",!0),!e.simple&&e.closable?(d(),O("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:g(t(s).e("icon-close")),onClick:F},[A(t(ke),null,{default:x(()=>[A(t(Ze))]),_:1})],2)):C("",!0)],34)):C("",!0),Q("div",{class:g([t(s).e("body"),e.bodyClass]),style:G(e.bodyStyle)},[Z(e.$slots,"default")],6),e.footer?(d(),O("div",{key:1,class:g(t(s).e("footer"))},[Z(e.$slots,"footer",{},()=>[e.hideCancel?C("",!0):(d(),$(t(be),K({key:0},e.cancelButtonProps,{size:e.size,onClick:F}),{default:x(()=>[ee(oe(e.cancelText||t(v)("tu.modal.cancel")),1)]),_:1},16,["size"])),A(t(be),K({type:"primary"},e.okButtonProps,{size:e.size,loading:D.value,onClick:Me}),{default:x(()=>[ee(oe(e.okText||t(v)("tu.modal.confirm")),1)]),_:1},16,["size","loading"])])],2)):C("",!0)],6),[[J,n.value]])]),_:3},8,["name"])],34)],16)),[[J,n.value||M.value]]):C("",!0)],8,["to","disabled"]))]),_:3}))}}),ae=(a,r)=>{let i=Le("modal");const m=()=>{l.component&&(l.component.props.visible=!1),N(a.onOk)&&a.onOk()},o=()=>{l.component&&(l.component.props.visible=!1),N(a.onCancel)&&a.onCancel()},f=async()=>{await We(),i&&(ge(null,i),document.body.removeChild(i)),i=null,N(a.onClose)&&a.onClose()},v=()=>{l.component&&(l.component.props.visible=!1)},s=h=>{l.component&&Object.entries(h).forEach(([P,z])=>{l.component.props[P]=z})},l=A(V,{visible:!0,renderToBody:!1,unmountOnClose:!0,onOk:m,onCancel:o,onClose:f,...Qe(a,["content","title","footer","visible","unmountOnClose","onOk","onCancel","onClose"]),footer:typeof a.footer=="boolean"?a.footer:void 0},{default:X(a.content),title:X(a.title),footer:typeof a.footer!="boolean"?X(a.footer):void 0});return(r??V._context)&&(l.appContext=r??V._context),ge(l,i),document.body.appendChild(i),{close:v,update:s}},no={open:ae,confirm:(a,r)=>{const i={simple:!0,...a};return ae(i,r)},...Be.reduce((a,r)=>(a[r]=(i,m)=>{const o={simple:!0,hideCancel:!0,messageType:r,...i};return ae(o,m)},a),{})},mo=Ie(V),fo=Re(no,"$modal");export{fo as d,mo as s};
