import{o as H,e as te,b as _e,u as $e,a as W,c as Ne,d as de,j as je,i as pe,x as De,g as Le,f as X,w as Ie,h as Re}from"./ResizeObserver.es.890944a3.js";import{h as p,d as we,a5 as Fe,g as B,x as me,a6 as He,j as Ve,o as d,b as $,w as x,a7 as Ye,l as t,a8 as K,c as O,L as q,H as A,T as fe,n as g,N as G,a9 as J,e as C,k as Q,a1 as ve,I as Ue,r as Z,a as ee,t as oe,aa as N,ab as ye,ac as ge,O as We}from"./framework.e9733b05.js";import{s as Be,e as Xe}from"./message.72cbba73.js";import{u as Ke,a as qe,b as be,m as Ge,K as Je,o as Qe}from"./index.d63e508b.js";import{T as Ce,f as ke}from"./index.dedbea18.js";import{u as Ze}from"./index.b4d91b20.js";import{c as eo}from"./index.8c9f13a0.js";const oo=({modalRef:a,wrapperRef:r,draggable:i})=>{const m=p(!1),o=p([0,0]),f=p([0,0]),v=p([0,0]),s=p(),l=p([0,0]),h=()=>{var c,b;if(r.value&&a.value){const{top:T,left:u}=r.value.getBoundingClientRect(),{clientWidth:n,clientHeight:j}=r.value,{top:D,left:z,width:E,height:L}=a.value.getBoundingClientRect(),_=z-u,I=D-T;(_!==((c=v.value)==null?void 0:c[0])||I!==((b=v.value)==null?void 0:b[1]))&&(v.value=[_,I]);const R=n>E?n-E:0,y=j>L?j-L:0;(R!==l.value[0]||y!==l.value[1])&&(l.value=[R,y])}},P=c=>{i.value&&(c.preventDefault(),m.value=!0,h(),o.value=[c.x,c.y],f.value=[0,0],H(window,"mousemove",M),H(window,"mouseup",k),H(window,"contextmenu",k))},M=c=>{if(m.value){const b=c.x-o.value[0],T=c.y-o.value[1];let u=v.value[0]+b,n=v.value[1]+T;u<0&&(u=0),u>l.value[0]&&(u=l.value[0]),n<0&&(n=0),n>l.value[1]&&(n=l.value[1]),s.value=[u,n]}},k=()=>{m.value=!1,te(window,"mousemove",M),te(window,"mouseup",k)};return{position:s,handleMoveDown:P}},ao=_e({visible:{type:Boolean,default:void 0},defaultVisible:{type:Boolean,default:!1},width:{type:[Number,String]},top:{type:[Number,String]},mask:{type:Boolean,default:!0},title:{type:String},titleAlign:{type:String,default:"start"},alignCenter:{type:Boolean,default:!0},unmountOnClose:Boolean,maskClosable:{type:Boolean,default:!0},hideCancel:{type:Boolean,default:!1},simple:{type:Boolean,default:a=>a.notice},closable:{type:Boolean,default:!0},okText:String,cancelText:String,okLoading:{type:Boolean,default:!1},okButtonProps:{type:Object},cancelButtonProps:{type:Object},footer:{type:Boolean,default:!0},renderToBody:{type:Boolean,default:!0},popupContainer:{type:[String,Object],default:"body"},maskStyle:{type:Object},modalClass:{type:[String,Array]},modalStyle:{type:Object},onBeforeOk:{type:Function},onBeforeCancel:{type:Function},escToClose:{type:Boolean,default:!0},size:{...$e,default:"medium"},draggable:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},maskAnimationName:{type:String,default:a=>a.fullscreen?"fade-in-standard":"fade-modal"},modalAnimationName:{type:String,default:a=>a.fullscreen?"zoom-in":"zoom-modal"},bodyClass:{type:[String,Array]},bodyStyle:{type:[String,Object,Array]},messageType:{type:String,values:Be,default:Xe.type}}),to={"update:visible":a=>!0,ok:a=>!0,cancel:a=>!0,open:()=>!0,close:()=>!0,beforeOpen:()=>!0,beforeClose:()=>!0};const lo=["onClick","onMousedown"],no=we({name:"TuModal",inheritAttrs:!1}),V=we({...no,props:ao,emits:to,setup(a,{emit:r}){let i=0,m=!1;const o=a,f=r,{t:v}=Ze(),s=W("modal"),l=W("modal-container"),h=W("modal-wrapper"),{fullscreen:P,popupContainer:M}=Fe(o),k=p(),c=p(),b=p(o.defaultVisible),T=p(!1),u=p(!1),n=B(()=>o.visible??b.value),j=B(()=>o.okLoading||u.value),D=B(()=>Ce[o.messageType]||""),z=p(n.value),E=B(()=>o.draggable&&!o.fullscreen),{teleportContainer:L,containerRef:_}=Ke({popupContainer:M,visible:n}),{zIndex:I,isLastDialog:R}=Ne("dialog",{visible:n}),{position:y,handleMoveDown:le}=oo({wrapperRef:k,modalRef:c,draggable:E}),{setOverflowHidden:ne,resetOverflow:se}=qe(_),he=B(()=>({[h.b()]:!0,[h.is("align-center")]:o.alignCenter&&!o.fullscreen,[h.is("moved")]:!!y.value})),Te=B(()=>{const e=o.messageType;return{[s.em("icon",e)]:e&&Ce[e]}}),Se=B(()=>[s.b(),o.modalClass,{[s.m(o.size)]:o.size,[s.m("simple")]:o.simple,[s.m("draggable")]:E.value,[s.m("fullscreen")]:o.fullscreen}]),xe=B(()=>{const e={...o.modalStyle??{}};return o.width&&(e.width=de(o.width)),!o.alignCenter&&o.top&&(e.top=de(o.top)),y.value&&(e.transform=`translate(${y.value[0]}px, ${y.value[1]}px)`),e}),Oe=e=>{o.mask&&o.maskClosable&&T.value&&F(e)},Me=e=>{e.target===k.value&&(T.value=!0)},ze=async e=>{const S=i,Y=await new Promise(async U=>{if(N(o.onBeforeOk)){let w=o.onBeforeOk((Pe=!0)=>U(Pe));if((ye(w)||!pe(w))&&(u.value=!0),ye(w))try{w=await w??!0}catch{w=!1}pe(w)&&U(w)}else U(!0)});S===i&&(Y?(f("ok",e),ie()):u.value&&(u.value=!1))},F=e=>{let S=!0;N(o.onBeforeCancel)&&(S=o.onBeforeCancel()??!1),S&&(f("cancel",e),ie())},ie=()=>{i++,u.value&&(u.value=!1),b.value=!1,f("update:visible",!1)},Ee=()=>{n.value&&(!De(k.value,document.activeElement)&&document.activeElement instanceof HTMLElement&&document.activeElement.blur(),f("open"))},Ae=()=>{n.value||(E.value&&(y.value=void 0),z.value=!1,se(),f("close"))},ue=()=>{o.escToClose&&!m&&(m=!0,H(document.documentElement,"keydown",ce))},re=()=>{m=!1,te(document.documentElement,"keydown",ce)},ce=e=>{o.escToClose&&e.key===Je.ESC&&R()&&F(e)};return me(P,()=>{y.value&&(y.value=void 0)}),me(n,e=>{b.value!==e&&(b.value=e),e?(f("beforeOpen"),z.value=!0,T.value=!1,ne(),ue()):(f("beforeClose"),re())}),He(()=>{se(),re()}),Ve(()=>{_.value=je(o.popupContainer),n.value&&(ne(),o.escToClose&&ue())}),(e,S)=>(d(),$(t(Ge),null,{default:x(()=>[(d(),$(Ye,{to:t(L),disabled:!e.renderToBody},[!e.unmountOnClose||n.value||z.value?K((d(),O("div",q({key:0,class:t(l).b(),style:{zIndex:t(I)}},e.$attrs),[A(fe,{name:e.maskAnimationName,appear:""},{default:x(()=>[e.mask?K((d(),O("div",{key:0,ref:"maskRef",class:g(t(l).e("mask")),style:G(e.maskStyle)},null,6)),[[J,n.value]]):C("",!0)]),_:1},8,["name"]),Q("div",{ref_key:"wrapperRef",ref:k,class:g(he.value),onClick:ve(Oe,["self"]),onMousedown:ve(Me,["self"])},[A(fe,{appear:"",name:e.modalAnimationName,onAfterEnter:Ee,onAfterLeave:Ae},{default:x(()=>[K(Q("div",{ref_key:"modalRef",ref:c,class:g(Se.value),style:G(xe.value)},[e.$slots.title||e.title||e.closable?(d(),O("div",{key:0,class:g(t(s).e("header")),onMousedown:S[0]||(S[0]=(...Y)=>t(le)&&t(le)(...Y))},[e.$slots.title||e.title?(d(),O("div",{key:0,class:g([t(s).e("title"),t(s).is(`align-${e.titleAlign}`)])},[e.messageType?(d(),O("div",{key:0,class:g(t(s).e("title-icon"))},[D.value?(d(),$(t(ke),{key:0,class:g([t(s).e("icon"),Te.value])},{default:x(()=>[(d(),$(Ue(D.value)))]),_:1},8,["class"])):C("",!0)],2)):C("",!0),Z(e.$slots,"title",{},()=>[ee(oe(e.title),1)])],2)):C("",!0),!e.simple&&e.closable?(d(),O("div",{key:1,tabindex:"-1",role:"button","aria-label":"Close",class:g(t(s).e("icon-close")),onClick:F},[A(t(ke),null,{default:x(()=>[A(t(eo))]),_:1})],2)):C("",!0)],34)):C("",!0),Q("div",{class:g([t(s).e("body"),e.bodyClass]),style:G(e.bodyStyle)},[Z(e.$slots,"default")],6),e.footer?(d(),O("div",{key:1,class:g(t(s).e("footer"))},[Z(e.$slots,"footer",{},()=>[e.hideCancel?C("",!0):(d(),$(t(be),q({key:0},e.cancelButtonProps,{size:e.size,onClick:F}),{default:x(()=>[ee(oe(e.cancelText||t(v)("tu.modal.cancel")),1)]),_:1},16,["size"])),A(t(be),q({type:"primary"},e.okButtonProps,{size:e.size,loading:j.value,onClick:ze}),{default:x(()=>[ee(oe(e.okText||t(v)("tu.modal.confirm")),1)]),_:1},16,["size","loading"])])],2)):C("",!0)],6),[[J,n.value]])]),_:3},8,["name"])],42,lo)],16)),[[J,n.value||z.value]]):C("",!0)],8,["to","disabled"]))]),_:3}))}}),ae=(a,r)=>{let i=Le("modal");const m=()=>{l.component&&(l.component.props.visible=!1),N(a.onOk)&&a.onOk()},o=()=>{l.component&&(l.component.props.visible=!1),N(a.onCancel)&&a.onCancel()},f=async()=>{await We(),i&&(ge(null,i),document.body.removeChild(i)),i=null,N(a.onClose)&&a.onClose()},v=()=>{l.component&&(l.component.props.visible=!1)},s=h=>{l.component&&Object.entries(h).forEach(([P,M])=>{l.component.props[P]=M})},l=A(V,{visible:!0,renderToBody:!1,unmountOnClose:!0,onOk:m,onCancel:o,onClose:f,...Qe(a,["content","title","footer","visible","unmountOnClose","onOk","onCancel","onClose"]),footer:typeof a.footer=="boolean"?a.footer:void 0},{default:X(a.content),title:X(a.title),footer:typeof a.footer!="boolean"?X(a.footer):void 0});return(r??V._context)&&(l.appContext=r??V._context),ge(l,i),document.body.appendChild(i),{close:v,update:s}},so={open:ae,confirm:(a,r)=>{const i={simple:!0,...a};return ae(i,r)},...Be.reduce((a,r)=>(a[r]=(i,m)=>{const o={simple:!0,hideCancel:!0,messageType:r,...i};return ae(o,m)},a),{})},vo=Ie(V),yo=Re(so,"$modal");export{yo as d,vo as s};
